<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apple-Style Weather</title>
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<!-- Feather Icons -->
<script src="https://unpkg.com/feather-icons"></script>
<style>
  /* ---------------- Fonts ---------------- */
  body {
    margin: 0;
    font-family: -apple-system, "SF Pro Rounded", Segoe UI, Roboto, system-ui, sans-serif;
    background: radial-gradient(circle at 20% 20%, #dfe8ff, #f5f7ff 40%, #f9fbff 70%, #ffffff);
    overflow: hidden;
    height: 100vh;
  }

  /* ---------------- Floating sheen ---------------- */
  body::after {
    content: '';
    position: absolute;
    width: 300%;
    height: 300%;
    top: -100%;
    left: -100%;
    background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%);
    filter: blur(200px);
    animation: sheen 15s linear infinite;
    pointer-events: none;
  }

  @keyframes sheen {
    0% { transform: rotate(0deg) translate(0,0);}
    100% { transform: rotate(360deg) translate(0,0);}
  }

  /* ---------------- Glass Panel ---------------- */
  .glass {
    background: rgba(255,255,255,0.16);
    border: 1px solid rgba(255,255,255,0.25);
    backdrop-filter: blur(20px) saturate(160%);
    border-radius: 20px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.1);
    color: #000;
  }

  /* ---------------- Header ---------------- */
  #header {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 16px 24px;
    display: flex;
    flex-direction: column;
    align-items: center;
    z-index: 1000;
    transition: all 0.3s ease;
  }
  #header h1 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: bold;
  }
  #header p {
    margin: 4px 0 0;
    font-size: 0.9rem;
    color: rgba(0,0,0,0.6);
  }

  /* ---------------- Chips ---------------- */
  .chips {
    position: fixed;
    bottom: 20px;
    right: 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    z-index: 1000;
  }
  .chip {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    font-size: 0.95rem;
    transition: all 0.3s ease;
  }

  /* ---------------- FAB ---------------- */
  #fab {
    position: fixed;
    bottom: 20px;
    left: 20px;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 1000;
    transition: all 0.3s ease;
  }

  /* ---------------- Sheet ---------------- */
  #sheet {
    position: fixed;
    bottom: 90px;
    left: 20px;
    width: 260px;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s ease;
    z-index: 1000;
  }
  #sheet.show {
    opacity: 1;
    pointer-events: auto;
  }
  .segmented {
    display: flex;
    gap: 4px;
  }
  .segmented button {
    flex: 1;
    padding: 8px;
    border: none;
    border-radius: 12px;
    background: rgba(255,255,255,0.14);
    color: #000;
    cursor: pointer;
    transition: 0.3s;
  }
  .segmented button.active {
    background: rgba(255,255,255,0.25);
    font-weight: bold;
  }
  label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.9rem;
  }

  /* ---------------- Map ---------------- */
  #map {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
  }

  /* ---------------- Toast ---------------- */
  #toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 20px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s ease;
    z-index: 1000;
  }
  #toast.show {
    opacity: 1;
    pointer-events: auto;
  }
</style>
</head>
<body>

<!-- Header -->
<div id="header" class="glass">
  <h1>Weather App</h1>
  <p id="location-status">Fetching location...</p>
</div>

<!-- Map -->
<div id="map"></div>

<!-- Chips -->
<div class="chips" id="chips">
  <div class="chip glass" id="wind"><i data-feather="wind"></i> Wind: -- km/h</div>
  <div class="chip glass" id="precip"><i data-feather="cloud-rain"></i> Precipitation: -- mm</div>
  <div class="chip glass" id="humidity"><i data-feather="droplet"></i> Humidity: --%</div>
</div>

<!-- FAB -->
<div id="fab" class="glass"><i data-feather="settings"></i></div>

<!-- Sheet -->
<div id="sheet" class="glass">
  <div class="segmented">
    <button class="active" data-layer="Standard">Standard</button>
    <button data-layer="Topo">Topo</button>
    <button data-layer="Satellite">Satellite</button>
  </div>
  <label><input type="checkbox" checked data-chip="wind"> Wind</label>
  <label><input type="checkbox" checked data-chip="precip"> Precipitation</label>
  <label><input type="checkbox" checked data-chip="humidity"> Humidity</label>
</div>

<!-- Toast -->
<div id="toast" class="glass">Toast message</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  feather.replace();

  // ---------------- Map ----------------
  let map = L.map('map').setView([20.5937, 78.9629], 5); // Default India

  const layers = {
    "Standard": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '' }).addTo(map),
    "Topo": L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', { attribution: '' }),
    "Satellite": L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', { attribution: '' })
  };

  // ---------------- Geolocation ----------------
  const locationStatus = document.getElementById('location-status');
  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      map.setView([lat, lon], 10);
      locationStatus.textContent = `Lat: ${lat.toFixed(2)}, Lon: ${lon.toFixed(2)}`;
      fetchWeather(lat, lon);
    },
    (err) => {
      showToast("Geolocation unavailable. Using default location.");
      locationStatus.textContent = "India";
      fetchWeather(20.5937, 78.9629);
    }
  );

  // ---------------- Weather ----------------
  async function fetchWeather(lat, lon) {
    try {
      const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
      const data = await res.json();
      const weather = data.current_weather;
      document.getElementById('wind').innerHTML = `<i data-feather="wind"></i> Wind: ${weather.windspeed} km/h`;
      document.getElementById('precip').innerHTML = `<i data-feather="cloud-rain"></i> Precipitation: ${weather.precipitation || 0} mm`;
      document.getElementById('humidity').innerHTML = `<i data-feather="droplet"></i> Humidity: ${weather.humidity || '--'}%`;
      feather.replace();
    } catch(e) {
      showToast("Failed to fetch weather data.");
    }
  }

  // ---------------- FAB & Sheet ----------------
  const fab = document.getElementById('fab');
  const sheet = document.getElementById('sheet');
  fab.addEventListener('click', () => sheet.classList.toggle('show'));

  // ---------------- Segmented buttons ----------------
  sheet.querySelectorAll('.segmented button').forEach(btn => {
    btn.addEventListener('click', () => {
      sheet.querySelectorAll('.segmented button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const layerName = btn.dataset.layer;
      Object.values(layers).forEach(l => map.removeLayer(l));
      layers[layerName].addTo(map);
    });
  });

  // ---------------- Checkboxes ----------------
  sheet.querySelectorAll('input[type="checkbox"]').forEach(cb => {
    cb.addEventListener('change', () => {
      const chip = document.getElementById(cb.dataset.chip);
      chip.style.display = cb.checked ? 'flex' : 'none';
    });
  });

  // ---------------- Toast ----------------
  const toast = document.getElementById('toast');
  function showToast(msg) {
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 3000);
  }
</script>
</body>
</html>
